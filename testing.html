<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>View Orders</title>
    <!-- Link to Bootstrap CSS -->
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      /* Custom CSS */
      /* Adjust spacing between columns */
      .col-lg-1,
      .col-lg-10 {
        padding: 0;
      }
    </style>
  </head>

  <body>
    <div class="orderlist">
      <div class="row">
        <div class="col-lg-1"></div>
        <div class="col-lg-10">
          <!-- Wrap the table in a div with table-responsive class -->
          <div class="table-responsive">
            <table class="table fixed-header">
              <thead>
                <tr>
                  <th scope="col">Order No</th>
                  <th scope="col">Customer ID</th>
                  <th scope="col">Cart ID</th>
                  <th scope="col">Country</th>
                  <th scope="col">Town</th>
                  <th scope="col">Phone</th>
                  <th scope="col">Status</th>
                  <th scope="col">Timestamps</th>
                </tr>
              </thead>
              <tbody class="scrollable-body">
                <!-- Table rows will be populated dynamically using JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
        <div class="col-lg-1"></div>
      </div>
    </div>

    <script>
      function viewOrders() {
        const orderView = document.querySelector(".orderlist");
        const urlOrders = "http://localhost:1600/api/orders";
        const urlCustomers = "http://localhost:1600/api/customers"; // New API endpoint URL

        const methodOrder = {
          method: "GET",
        };

        let ordersData = [];
        let customersData = []; // Array to store data from the new endpoint

        // Fetch data from the orders API endpoint
        fetch(urlOrders, methodOrder)
          .then((response) => response.json())
          .then((ordersResult) => {
            console.log("Orders:", ordersResult); // Log the response data

            // Process data from the orders endpoint
            ordersResult.forEach((order) => {
              ordersData += `
        <tr>
          <th scope="row">${order.orderNo}</th>
          <td>${order.customerId}</td>
          <td>${order.cartId}</td>
          <td>${order.shippingAddress.country}</td>
          <td>${order.shippingAddress.town}</td>
          <td>${order.shippingAddress.phone}</td>
          <td><button class="btn btn-success">${order.status}</button></td>
          <td>${order.orderDate}</td>
        </tr>
      `;
            });

            // Update the orders table with the fetched data
            orderView.querySelector("tbody").innerHTML = ordersData;
          })
          .catch((error) => {
            console.error("Error fetching orders:", error);
          });

        // Fetch data from the customers API endpoint
        fetch(urlCustomers, methodOrder)
          .then((response) => response.json())
          .then((customersResult) => {
            console.log("Customers:", customersResult); // Log the response data

            // Process data from the customers endpoint
            customersResult.forEach((customer) => {
              // Example: Display customer data in the console
              console.log("Customer ID:", customer.id);
              console.log("Customer Name:", customer.name);

              // Store customer data in the customersData array for further use if needed
              customersData.push(customer);
            });

            // Further processing of customer data can be added here
          })
          .catch((error) => {
            console.error("Error fetching customers:", error);
          });
      }

      viewOrders();
    </script>
  </body>
</html>
